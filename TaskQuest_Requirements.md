# 企業向けゲーミフィケーションタスク管理システム 要件定義書

**プロジェクト名：TaskQuest（仮称）**  
**バージョン：1.0**  
**作成日：2026年1月9日**  
**開発環境：Google Antigravity**

---

## 📑 目次

1. [システム概要](#1-システム概要)
2. [機能要件定義](#2-機能要件定義)
3. [画面設計・遷移図](#3-画面設計遷移図)
4. [データベース設計](#4-データベース設計)
5. [API仕様](#5-api仕様)
6. [ゲーミフィケーション設計](#6-ゲーミフィケーション設計)
7. [ポイント・報酬システム設計](#7-ポイント報酬システム設計)
8. [技術スタック](#8-技術スタック)
9. [セキュリティ要件](#9-セキュリティ要件)
10. [開発フェーズとスケジュール](#10-開発フェーズとスケジュール)

---

## 1. システム概要

### 1.1 プロジェクトの目的

従業員の日々の業務タスクをゲーム感覚で楽しく進められるようにし、以下を実現する：

- **エンゲージメント向上**：ログインボーナスや達成報酬で毎日の業務へのモチベーションを高める
- **生産性向上**：タスク完了を可視化し、進捗管理を効率化
- **公平な評価**：ポイントによる定量的な業績評価
- **給与・インセンティブ連携**：獲得ポイントを給与やボーナスに反映

### 1.2 システムの特徴

| 特徴 | 説明 |
|------|------|
| ゲーミフィケーション | RPG風のXP・レベルシステム、バッジ、ログインボーナス |
| リアルタイム通知 | タスク割り当て、ポイント獲得時に即座に通知 |
| モバイル対応 | スマートフォンでもシームレスに利用可能（レスポンシブデザイン） |
| 柔軟な報酬システム | ギフトカード、有給休暇、研修参加など多様な交換先 |
| 管理者ダッシュボード | チーム全体の進捗、ポイント配分状況を可視化 |

### 1.3 想定ユーザー

- **一般従業員**：タスクを受け取り、完了してポイントを獲得
- **マネージャー**：タスク割り当て、ポイント付与、チーム進捗管理
- **管理者（HR/経営層）**：システム全体の設定、レポート閲覧、給与連携

### 1.4 対象規模

- **初期**：50～200名規模の企業
- **拡張可能**：500名以上への対応も視野

---

## 2. 機能要件定義

### 2.1 認証・ユーザー管理

#### 2.1.1 ログイン機能
- 社員ID + パスワードまたはGoogle OAuthによるログイン
- 初回ログイン時：プロフィール設定（アバター選択、ニックネーム）
- パスワードリセット機能

#### 2.1.2 ユーザー権限
- **一般ユーザー**：タスク閲覧・完了、ポイント確認、報酬交換
- **マネージャー**：上記 + タスク作成・割り当て、部下のポイント付与
- **管理者**：上記すべて + ユーザー管理、システム設定、レポート出力

#### 2.1.3 プロフィール管理
- 表示名、メールアドレス、所属部署
- アバター画像のアップロード
- レベル、獲得XP、保有ポイントの表示

### 2.2 タスク管理機能

#### 2.2.1 タスクの種類
- **個人タスク**：特定の従業員に割り当て
- **チームタスク**：複数人で協力して完了
- **定期タスク**：毎日/毎週/毎月繰り返し

#### 2.2.2 タスクの属性

```json
{
  "id": "uuid",
  "title": "タスク名",
  "description": "詳細説明",
  "assignedTo": ["userId1", "userId2"],
  "createdBy": "managerId",
  "priority": "high" | "medium" | "low",
  "difficulty": 1-5,
  "basePoints": 100,
  "bonusXP": 50,
  "deadline": "2026-01-15T23:59:59Z",
  "status": "pending" | "in_progress" | "completed" | "overdue",
  "tags": ["営業", "緊急"],
  "createdAt": "timestamp",
  "completedAt": "timestamp"
}
```

#### 2.2.3 タスク作成・割り当て
- マネージャーがタスク作成フォームから入力
- 担当者を選択（複数選択可能）
- 優先度、期限、難易度、基礎ポイントを設定
- 作成時に担当者へ通知

#### 2.2.4 タスク完了フロー
1. 従業員がタスクを「進行中」に変更
2. 作業完了後「完了報告」ボタンをクリック
3. マネージャーが承認（必要に応じて）
4. 承認後、ポイント・XPが自動付与
5. アニメーション付きで獲得通知を表示

#### 2.2.5 ToDoリスト表示
- **フィルター機能**：ステータス、優先度、期限、タグ
- **ソート機能**：期限順/優先度順/ポイント順
- **検索機能**：タスク名・説明文で検索

### 2.3 ゲーミフィケーション機能

#### 2.3.1 XP・レベルシステム
- タスク完了でXP（経験値）を獲得
- 一定XPでレベルアップ
- レベルアップ時：お祝いアニメーション、ボーナスポイント付与、新機能・報酬のアンロック

**レベル計算式：**
```
必要XP = 100 × (現在レベル)^1.5
```

**レベル到達報酬例：**
- Lv.5：アバター装備アンロック
- Lv.10：月次ボーナスポイント+500
- Lv.20：「エキスパート」バッジ獲得
- Lv.50：CEOランチ券交換権

#### 2.3.2 ログインボーナス

**デイリーログインボーナス：**
- 毎日初回ログインで50pt + 10XP
- 連続ログインストリーク記録
  - 3日連続：+50pt
  - 7日連続：+150pt
  - 30日連続：+1,000pt + 特別バッジ

**ログインカレンダー画面：**
- 今月のログイン状況を可視化
- 未ログイン日はグレーアウト
- ストリークが途切れても完全リセットせず、翌日から再スタート

#### 2.3.3 達成バッジ・トロフィー

| バッジ名 | 獲得条件 | 報酬 |
|----------|----------|------|
| 🏃 スピードマスター | タスク10個を期限前に完了 | 200pt |
| 🔥 連続達成王 | 7日連続でタスク完了 | 300pt |
| 🌟 品質マスター | 高評価タスク5個達成 | 500pt |
| 👥 チームプレイヤー | チームタスク20個完了 | 400pt |
| 🎯 100タスク達成 | 累計100タスク完了 | 1,000pt + 特別称号 |

**バッジ獲得時：**
- ポップアップアニメーション
- プロフィールに表示
- SNS風の「シェア」機能（社内掲示板へ投稿）

#### 2.3.4 リーダーボード（ランキング）

**表示オプション：**
- 全社ランキング
- 部署別ランキング
- 週間/月間/年間

**表示項目：**
- 順位、名前、獲得ポイント、完了タスク数、レベル

**プライバシー配慮：**
- ランキング表示をオプトアウト可能
- 上位10位のみ表示（競争を緩和）

#### 2.3.5 プログレスバー

**個人ダッシュボード：**
- 次のレベルまでのXP進捗
- 今月の目標タスク数達成率
- ログインストリーク進捗

**視覚的フィードバック：**
- リアルタイムでバーが伸びるアニメーション
- 達成時に色が変わる（緑→ゴールド）

### 2.4 ポイント・報酬システム

#### 2.4.1 ポイント付与ルール

**タスク完了時の基礎ポイント：**
- 優先度低：50～100pt
- 優先度中：100～300pt
- 優先度高：300～500pt
- 緊急タスク：500～1,000pt

**ボーナスポイント：**
- 期限前完了：+20%
- 高評価（マネージャー評価）：+50pt～200pt
- チームタスク貢献：均等分配または貢献度による配分

**その他のポイント獲得：**
- ログインボーナス：50pt/日
- 同僚への感謝（ピアボーナス）：受け取った側が50pt獲得
- イノベーション提案採用：2,000～5,000pt

#### 2.4.2 ポイント換算率
- 推奨：10:1（10ポイント = 1円相当）
- 10,000pt = 1,000円分の報酬

#### 2.4.3 報酬カタログ

**🎁 金銭的報酬（40%）**
- Amazonギフトカード：5,000pt（500円）～50,000pt（5,000円）
- コンビニギフトカード：5,000pt～
- Uber Eatsクーポン：10,000pt（1,000円）
- NetflixやSpotify月額サブスク：15,000pt

**🌟 体験型報酬（30%）**
- 有給休暇半日：15,000pt
- 有給休暇1日：30,000pt
- CEOとのランチ：50,000pt
- 社外研修参加券：100,000pt
- チームランチ券（5名分）：20,000pt

**🛍️ グッズ報酬（20%）**
- 高級オフィスチェア：150,000pt
- ワイヤレスイヤホン：50,000pt～
- スマートウォッチ：100,000pt
- 会社ロゴ入りプレミアムグッズ：5,000pt～

**📚 成長支援報酬（10%）**
- オンライン講座受講券：50,000pt
- 書籍購入補助：10,000pt
- 資格試験受験料補助：100,000pt

#### 2.4.4 報酬交換フロー
1. 「報酬カタログ」ページから商品を選択
2. 保有ポイントが足りるか自動チェック
3. 「交換する」ボタンをクリック
4. 確認ダイアログ表示
5. 交換完了後、ポイント減算
6. 管理者に通知→報酬の手配
7. 従業員に「交換完了」通知（ギフトコード等を送付）

#### 2.4.5 ポイント履歴
- 獲得・使用履歴を一覧表示
- 日付、内容、増減ポイント、残高
- CSV/PDFでエクスポート可能

### 2.5 給与・インセンティブ連携機能

#### 2.5.1 月次集計レポート
- 毎月末に自動生成
- 従業員ごとの獲得ポイント合計
- タスク完了数、達成率
- CSVエクスポートで給与システムへ取り込み

#### 2.5.2 インセンティブ計算式（例）
```
月次ボーナス = (獲得ポイント ÷ 10) × 0.5
例：20,000pt獲得 → 1,000円のボーナス
```
- 企業ごとにカスタマイズ可能
- 管理画面で計算式を設定

#### 2.5.3 自動給与連携（オプション機能）
- 既存の給与システムAPIと連携
- 月次で自動的にインセンティブ額を送信
- 承認フローを挟むことも可能

### 2.6 管理者機能

#### 2.6.1 ダッシュボード

**全体統計：**
- 総登録ユーザー数
- 月間アクティブユーザー数
- 総タスク完了数
- 総ポイント発行数

**グラフ表示：**
- 日別/週別/月別のタスク完了推移
- 部門別タスク達成率
- ポイント消費トレンド

#### 2.6.2 ユーザー管理
- ユーザー一覧（検索・フィルター）
- 新規ユーザー追加（CSV一括登録対応）
- 権限変更（一般→マネージャー等）
- アカウント無効化

#### 2.6.3 タスクテンプレート管理
- 頻繁に使うタスクをテンプレート化
- ワンクリックで再利用
- 例：「月次報告書作成」「顧客訪問記録」

#### 2.6.4 ポイントルール設定
- タスク難易度別の基礎ポイント設定
- ボーナスポイント倍率調整
- ログインボーナス額の変更

#### 2.6.5 報酬カタログ編集
- 報酬アイテムの追加・削除
- 必要ポイント数の変更
- 在庫管理（限定報酬の場合）

#### 2.6.6 レポート出力
- 従業員別ポイント獲得レポート
- 部門別生産性レポート
- タスク完了率レポート
- PDF/Excel形式でダウンロード

### 2.7 通知機能

#### 2.7.1 通知タイプ

**タスク関連：**
- 新規タスク割り当て
- タスク期限3日前/1日前
- タスク承認・却下

**ポイント関連：**
- ポイント獲得
- レベルアップ
- バッジ獲得
- ログインボーナス獲得

**その他：**
- 同僚からの感謝メッセージ
- ランキング順位変動（上位入りした場合）

#### 2.7.2 通知方法
- アプリ内通知：ベルアイコンで確認
- メール通知：設定でON/OFF可能
- プッシュ通知（PWA対応時）

### 2.8 ソーシャル機能（オプション）

#### 2.8.1 ピアボーナス（同僚への感謝）
- 従業員同士でポイントを送り合える
- 月間上限：500pt/人
- メッセージ付きで送信
- 送った側にもXPボーナス

#### 2.8.2 社内掲示板
- バッジ獲得やレベルアップを投稿
- 「いいね」やコメント機能
- チームの士気向上を促進

---

## 3. 画面設計・遷移図

### 3.1 画面一覧

| 画面名 | URL | 権限 | 説明 |
|--------|-----|------|------|
| ログイン | /login | 全員 | 認証画面 |
| ダッシュボード | /dashboard | 全員 | 個人のホーム画面 |
| タスク一覧 | /tasks | 全員 | ToDoリスト |
| タスク詳細 | /tasks/:id | 全員 | タスクの詳細情報 |
| プロフィール | /profile | 全員 | ユーザー情報・レベル・バッジ |
| 報酬カタログ | /rewards | 全員 | ポイント交換画面 |
| ランキング | /leaderboard | 全員 | リーダーボード |
| タスク作成 | /tasks/new | マネージャー以上 | 新規タスク作成 |
| 管理ダッシュボード | /admin | 管理者 | 管理者用統計画面 |
| ユーザー管理 | /admin/users | 管理者 | ユーザー一覧・編集 |
| レポート | /admin/reports | 管理者 | 各種レポート出力 |

### 3.2 画面遷移図（メインフロー）

```
[ログイン画面] 
     ↓ 認証成功
[ダッシュボード] ← ホーム
     ├→ [タスク一覧] → [タスク詳細] → タスク完了 → ポイント獲得アニメーション
     ├→ [プロフィール] → レベル・バッジ確認
     ├→ [報酬カタログ] → 報酬交換 → 交換完了
     ├→ [ランキング] → 順位確認
     └→ [ログアウト]

[マネージャー]
     [ダッシュボード]
          └→ [タスク作成] → タスク割り当て → 通知送信

[管理者]
     [管理ダッシュボード]
          ├→ [ユーザー管理]
          ├→ [レポート]
          └→ [システム設定]
```

### 3.3 主要画面のワイヤーフレーム概要

#### 3.3.1 ダッシュボード（個人）

```
┌─────────────────────────────────────┐
│ TaskQuest            🔔 [通知] [👤]│
├─────────────────────────────────────┤
│ こんにちは、○○さん！ Lv.12 ⭐      │
│ ━━━━━━━━━━━━━━━ 85% (1,275/1,500 XP)│
│                                     │
│ 💰 保有ポイント: 12,450pt          │
│ 🔥 ログインストリーク: 7日連続      │
│                                     │
├─────────────────────────────────────┤
│ 📋 今日のタスク (3件)               │
│ ┌─────────────────────────────────┐ │
│ │ ☐ 営業報告書作成【高】期限: 今日 │ │
│ │    +300pt                       │ │
│ ├─────────────────────────────────┤ │
│ │ ☐ クライアント電話【中】         │ │
│ │    +150pt                       │ │
│ └─────────────────────────────────┘ │
│ → すべて見る                        │
├─────────────────────────────────────┤
│ 🏆 最近の達成                       │
│ [🌟品質マスター] 昨日獲得 +500pt   │
└─────────────────────────────────────┘
```

#### 3.3.2 タスク一覧

```
┌─────────────────────────────────────┐
│ TaskQuest > タスク一覧              │
├─────────────────────────────────────┤
│ [🔍検索] [フィルター▼] [ソート▼]   │
│                                     │
│ ☐ [高] 営業報告書作成               │
│    期限: 今日 23:59  +300pt         │
│                                     │
│ ☑ [中] 会議資料準備 【完了】        │
│    完了日: 1/8  +150pt 獲得済み     │
│                                     │
│ ☐ [低] メール返信                   │
│    期限: 1/12  +50pt                │
└─────────────────────────────────────┘
```

#### 3.3.3 報酬カタログ

```
┌─────────────────────────────────────┐
│ 報酬カタログ | 保有: 12,450pt       │
├─────────────────────────────────────┤
│ [カテゴリ選択] 全て ▼               │
│                                     │
│ ┌──────┐ ┌──────┐ ┌──────┐        │
│ │ 🎁   │ │ 🌟   │ │ 📚   │        │
│ │Amazon│ │有給  │ │研修  │        │
│ │5,000p│ │30,000│ │50,000│        │
│ └──────┘ └──────┘ └──────┘        │
│                                     │
│ [交換履歴を見る]                    │
└─────────────────────────────────────┘
```

---

## 4. データベース設計

### 4.1 ER図（概念図）

```
Users (ユーザー)
  ├─ Tasks (タスク) ※多対多
  ├─ Points_History (ポイント履歴)
  ├─ Rewards_Redemption (報酬交換履歴)
  ├─ Badges (バッジ獲得)
  └─ Login_Streak (ログインストリーク)

Tasks
  ├─ Task_Assignments (割り当て)
  └─ Task_Comments (コメント)

Rewards (報酬カタログ)
  └─ Rewards_Redemption
```

### 4.2 テーブル定義

#### 4.2.1 Users（ユーザー）

```sql
CREATE TABLE users (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  employee_id VARCHAR(50) UNIQUE NOT NULL,
  email VARCHAR(255) UNIQUE NOT NULL,
  password_hash VARCHAR(255),
  display_name VARCHAR(100),
  avatar_url VARCHAR(500),
  department VARCHAR(100),
  role VARCHAR(20) DEFAULT 'user',
  level INT DEFAULT 1,
  current_xp INT DEFAULT 0,
  total_points INT DEFAULT 0,
  available_points INT DEFAULT 0,
  login_streak INT DEFAULT 0,
  last_login_date DATE,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);
```

#### 4.2.2 Tasks（タスク）

```sql
CREATE TABLE tasks (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  title VARCHAR(200) NOT NULL,
  description TEXT,
  created_by UUID REFERENCES users(id),
  priority VARCHAR(20) DEFAULT 'medium',
  difficulty INT DEFAULT 3,
  base_points INT DEFAULT 100,
  bonus_xp INT DEFAULT 50,
  deadline TIMESTAMP,
  status VARCHAR(20) DEFAULT 'pending',
  tags TEXT[],
  completed_at TIMESTAMP,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);
```

#### 4.2.3 Task_Assignments（タスク割り当て）

```sql
CREATE TABLE task_assignments (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  task_id UUID REFERENCES tasks(id) ON DELETE CASCADE,
  user_id UUID REFERENCES users(id) ON DELETE CASCADE,
  assigned_at TIMESTAMP DEFAULT NOW(),
  UNIQUE(task_id, user_id)
);
```

#### 4.2.4 Points_History（ポイント履歴）

```sql
CREATE TABLE points_history (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES users(id) ON DELETE CASCADE,
  amount INT NOT NULL,
  reason VARCHAR(100),
  related_task_id UUID REFERENCES tasks(id),
  related_reward_id UUID,
  created_at TIMESTAMP DEFAULT NOW()
);
```

#### 4.2.5 Badges（バッジマスタ）

```sql
CREATE TABLE badges (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  name VARCHAR(100) NOT NULL,
  description TEXT,
  icon_url VARCHAR(500),
  condition_type VARCHAR(50),
  condition_value INT,
  reward_points INT DEFAULT 0,
  created_at TIMESTAMP DEFAULT NOW()
);
```

#### 4.2.6 User_Badges（ユーザーバッジ獲得）

```sql
CREATE TABLE user_badges (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES users(id) ON DELETE CASCADE,
  badge_id UUID REFERENCES badges(id) ON DELETE CASCADE,
  earned_at TIMESTAMP DEFAULT NOW(),
  UNIQUE(user_id, badge_id)
);
```

#### 4.2.7 Rewards（報酬カタログ）

```sql
CREATE TABLE rewards (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  name VARCHAR(200) NOT NULL,
  description TEXT,
  category VARCHAR(50),
  points_required INT NOT NULL,
  stock INT,
  image_url VARCHAR(500),
  is_active BOOLEAN DEFAULT TRUE,
  created_at TIMESTAMP DEFAULT NOW()
);
```

#### 4.2.8 Rewards_Redemption（報酬交換履歴）

```sql
CREATE TABLE rewards_redemption (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES users(id) ON DELETE CASCADE,
  reward_id UUID REFERENCES rewards(id),
  points_spent INT NOT NULL,
  status VARCHAR(20) DEFAULT 'pending',
  redemption_code VARCHAR(100),
  redeemed_at TIMESTAMP DEFAULT NOW(),
  delivered_at TIMESTAMP
);
```

#### 4.2.9 Login_Streaks（ログインストリーク）

```sql
CREATE TABLE login_streaks (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES users(id) ON DELETE CASCADE UNIQUE,
  current_streak INT DEFAULT 0,
  longest_streak INT DEFAULT 0,
  last_login_date DATE,
  updated_at TIMESTAMP DEFAULT NOW()
);
```

---

## 5. API仕様

### 5.1 API設計方針
- RESTful API
- 認証：JWT（JSON Web Token）
- レスポンス形式：JSON
- エラーハンドリング：統一されたエラーレスポンス

### 5.2 エンドポイント一覧

#### 5.2.1 認証系API

| メソッド | エンドポイント | 説明 | 権限 |
|----------|----------------|------|------|
| POST | /api/auth/login | ログイン | 全員 |
| POST | /api/auth/logout | ログアウト | 全員 |
| POST | /api/auth/refresh | トークン更新 | 全員 |
| POST | /api/auth/register | 新規登録（管理者用） | 管理者 |

**例：ログインAPI**

```json
POST /api/auth/login
Content-Type: application/json

{
  "employee_id": "EMP001",
  "password": "password123"
}

Response 200 OK:
{
  "success": true,
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "user": {
      "id": "uuid",
      "display_name": "田中太郎",
      "level": 12,
      "available_points": 12450
    }
  }
}
```

#### 5.2.2 ユーザー系API

| メソッド | エンドポイント | 説明 | 権限 |
|----------|----------------|------|------|
| GET | /api/users/me | 自分の情報取得 | 全員 |
| PUT | /api/users/me | プロフィール更新 | 全員 |
| GET | /api/users/:id | 特定ユーザー情報 | マネージャー以上 |
| GET | /api/users | ユーザー一覧 | 管理者 |

#### 5.2.3 タスク系API

| メソッド | エンドポイント | 説明 | 権限 |
|----------|----------------|------|------|
| GET | /api/tasks | タスク一覧取得 | 全員 |
| GET | /api/tasks/:id | タスク詳細 | 全員 |
| POST | /api/tasks | タスク作成 | マネージャー以上 |
| PUT | /api/tasks/:id | タスク更新 | 作成者または管理者 |
| DELETE | /api/tasks/:id | タスク削除 | 作成者または管理者 |
| POST | /api/tasks/:id/complete | タスク完了 | 担当者 |
| POST | /api/tasks/:id/approve | タスク承認 | マネージャー |

**例：タスク完了API**

```json
POST /api/tasks/abc123/complete
Authorization: Bearer {token}

Response 200 OK:
{
  "success": true,
  "data": {
    "task_id": "abc123",
    "points_earned": 350,
    "xp_earned": 100,
    "new_level": 12,
    "level_up": false
  }
}
```

#### 5.2.4 ポイント系API

| メソッド | エンドポイント | 説明 | 権限 |
|----------|----------------|------|------|
| GET | /api/points/history | ポイント履歴 | 全員 |
| GET | /api/points/balance | 現在の残高 | 全員 |
| POST | /api/points/grant | ポイント付与 | マネージャー以上 |

#### 5.2.5 報酬系API

| メソッド | エンドポイント | 説明 | 権限 |
|----------|----------------|------|------|
| GET | /api/rewards | 報酬カタログ | 全員 |
| POST | /api/rewards/redeem | 報酬交換 | 全員 |
| GET | /api/rewards/redemptions | 交換履歴 | 全員 |
| POST | /api/rewards | 報酬追加 | 管理者 |
| PUT | /api/rewards/:id | 報酬編集 | 管理者 |

#### 5.2.6 バッジ・ランキング系API

| メソッド | エンドポイント | 説明 | 権限 |
|----------|----------------|------|------|
| GET | /api/badges | 全バッジ一覧 | 全員 |
| GET | /api/badges/my | 自分のバッジ | 全員 |
| GET | /api/leaderboard | ランキング取得 | 全員 |

#### 5.2.7 ログインボーナス系API

| メソッド | エンドポイント | 説明 | 権限 |
|----------|----------------|------|------|
| POST | /api/login-bonus/claim | ログインボーナス受取 | 全員 |
| GET | /api/login-bonus/status | ストリーク状況 | 全員 |

---

## 6. ゲーミフィケーション設計

### 6.1 レベルシステム詳細

#### 6.1.1 レベル・XP計算

```javascript
// レベルアップに必要なXP
function getRequiredXP(level) {
  return Math.floor(100 * Math.pow(level, 1.5));
}

// 例
Level 1 → 2: 100 XP
Level 2 → 3: 283 XP
Level 5 → 6: 1,118 XP
Level 10 → 11: 3,162 XP
Level 20 → 21: 8,944 XP
```

#### 6.1.2 レベル別特典

| レベル | 特典 | 効果 |
|--------|------|------|
| Lv.1 | 新人 | 基本機能利用可能 |
| Lv.5 | 駆け出し | アバター装備解放、月次+200pt |
| Lv.10 | 熟練者 | 特別報酬アクセス、月次+500pt |
| Lv.20 | エキスパート | 「エキスパート」称号、CEO面談権 |
| Lv.30 | マスター | プレミアム報酬解放 |
| Lv.50 | レジェンド | 殿堂入り、特別記念品 |

### 6.2 バッジシステム詳細

#### 6.2.1 バッジカテゴリ

**🏃 生産性バッジ**
- スピードマスター：10タスクを期限前完了
- 連続達成王：7日連続タスク完了
- 100タスク達成：累計100タスク完了

**🌟 品質バッジ**
- 品質マスター：高評価5回獲得
- パーフェクト：1ヶ月間ミスゼロ

**👥 チームワークバッジ**
- チームプレイヤー：チームタスク20個完了
- サポーター：同僚への感謝10回送信

**🎯 特別バッジ**
- イノベーター：提案採用3回
- アーリーバード：早朝ログイン30日
- ナイトオウル：深夜作業完了10回

#### 6.2.2 バッジ獲得判定ロジック

```javascript
// タスク完了時にバッジ判定
async function checkBadgeEligibility(userId) {
  const user = await getUser(userId);
  const completedTasks = await getCompletedTasksCount(userId);
  
  // 100タスク達成バッジ
  if (completedTasks === 100) {
    await awardBadge(userId, 'task_100_achievement');
  }
  
  // 連続達成王バッジ
  const streak = await getTaskCompletionStreak(userId);
  if (streak === 7) {
    await awardBadge(userId, 'streak_7_days');
  }
}
```

### 6.3 ログインボーナス設計

#### 6.3.1 デイリーボーナステーブル

| 連続日数 | ボーナス | XP |
|----------|----------|-----|
| 1日目 | 50pt | 10 |
| 2日目 | 50pt | 10 |
| 3日目 | 100pt（ボーナス） | 20 |
| 4-6日目 | 50pt | 10 |
| 7日目 | 200pt（ボーナス） | 50 |
| 14日目 | 300pt | 100 |
| 30日目 | 1,000pt + 特別バッジ | 200 |

#### 6.3.2 ストリーク途切れ時の対応
- 1日休んだ場合：ストリークは0にリセットだが、累計日数は保持
- 「ストリーク保護券」（報酬で購入可能）：1回分スキップOK

---

## 7. ポイント・報酬システム設計

### 7.1 ポイント経済設計

#### 7.1.1 月間ポイント流通量の目安

**前提条件：**
- 従業員数：100名
- 平均タスク完了数：1人あたり月20タスク
- 平均ポイント単価：150pt/タスク

**計算：**
```
月間発行ポイント = 100名 × 20タスク × 150pt 
                 + 100名 × 30日 × 50pt（ログインボーナス）
                 = 300,000pt + 150,000pt
                 = 450,000pt

月間消費ポイント想定 = 発行の60～70%
                     = 270,000～315,000pt

ポイント換算（10:1） = 27,000～31,500円相当
```

**予算設定の推奨：**
- 月間予算：30,000～40,000円/月
- 年間予算：360,000～480,000円/年

#### 7.1.2 インフレ対策
- ポイント有効期限：獲得から12ヶ月（期限60日前に通知）
- 上限設定：月間獲得ポイント上限を20,000ptに設定（異常値検出）
- 定期的な報酬価格見直し：年2回、市場価格に合わせて調整

### 7.2 報酬カタログ詳細設計

#### 7.2.1 報酬分類とラインナップ

**🎁 金銭的報酬（40%）**

| 報酬名 | ポイント | 実売価格 | 在庫管理 |
|--------|----------|----------|----------|
| Amazonギフト500円 | 5,000pt | 500円 | 無制限 |
| Amazonギフト1,000円 | 10,000pt | 1,000円 | 無制限 |
| Amazonギフト5,000円 | 50,000pt | 5,000円 | 無制限 |
| スターバックス500円 | 5,000pt | 500円 | 無制限 |
| Uber Eats 1,000円 | 10,000pt | 1,000円 | 無制限 |
| Netflix 1ヶ月分 | 15,000pt | 1,490円 | 無制限 |

**🌟 体験型報酬（30%）**

| 報酬名 | ポイント | 価値 | 在庫 |
|--------|----------|------|------|
| 有給半日 | 15,000pt | - | 月5枠 |
| 有給1日 | 30,000pt | - | 月5枠 |
| CEOランチ | 50,000pt | - | 月1枠 |
| 部門長ランチ | 25,000pt | - | 月3枠 |
| 社外研修参加 | 100,000pt | 50,000円 | 四半期2枠 |
| チームランチ補助 | 20,000pt | 10,000円 | 無制限 |

**🛍️ グッズ報酬（20%）**

| 報酬名 | ポイント | 実売価格 |
|--------|----------|----------|
| ワイヤレスイヤホン | 50,000pt | 5,000円 |
| スマートウォッチ | 100,000pt | 10,000円 |
| オフィスチェア | 150,000pt | 15,000円 |
| 高級ボールペン | 10,000pt | 1,000円 |
| 会社ロゴTシャツ | 5,000pt | 500円 |

**📚 成長支援報酬（10%）**

| 報酬名 | ポイント | 価値 |
|--------|----------|------|
| Udemy講座 | 20,000pt | 2,000円 |
| 書籍購入補助 | 10,000pt | 1,000円 |
| 資格試験料補助 | 100,000pt | 10,000円 |
| 英会話レッスン | 50,000pt | 5,000円 |

#### 7.2.2 報酬交換制限
- 1日の交換上限：50,000pt まで（不正利用防止）
- 一部報酬の月間制限：有給休暇関連は月1回まで
- 承認フロー：10万pt以上の交換は管理者承認必須

---

## 8. 技術スタック

### 8.1 フロントエンド

**フレームワーク：**
- React 18 + TypeScript
- Next.js 14（App Router）

**UI ライブラリ：**
- Tailwind CSS：ユーティリティファーストCSS
- shadcn/ui：モダンなコンポーネントライブラリ
- Framer Motion：アニメーション

**状態管理：**
- Zustand または React Context

**データフェッチング：**
- TanStack Query (React Query)

### 8.2 バックエンド

**フレームワーク：**
- Node.js + Express
- または Python + FastAPI

**ORM：**
- Prisma（Node.js）または SQLAlchemy（Python）

**認証：**
- JWT（JSON Web Token）
- bcrypt：パスワードハッシュ化

**スケジューラー：**
- node-cron または Celery

### 8.3 データベース
- PostgreSQL 15
- pgAdmin または TablePlus で管理

### 8.4 インフラ・ホスティング

**推奨構成：**
- フロントエンド：Vercel
- バックエンド：Railway、Render、またはAWS EC2
- データベース：Supabase、Railway、またはAWS RDS
- ファイルストレージ：Cloudflare R2、AWS S3

**その他：**
- CI/CD：GitHub Actions
- 監視：Sentry、Vercel Analytics

### 8.5 開発ツール
- パッケージマネージャー：pnpm
- コードフォーマッター：Prettier
- リンター：ESLint
- バージョン管理：Git + GitHub
- API テスト：Postman

### 8.6 Google Antigravity最適化

**プロジェクト構造（モノレポ推奨）**

```
taskquest/
├── frontend/           # Next.js アプリ
│   ├── app/           # App Router
│   ├── components/    # Reactコンポーネント
│   ├── lib/           # ユーティリティ
│   └── public/        # 静的ファイル
├── backend/           # Node.js/Express API
│   ├── src/
│   │   ├── routes/    # APIルート
│   │   ├── models/    # Prismaモデル
│   │   ├── services/  # ビジネスロジック
│   │   └── utils/     # ヘルパー関数
│   └── prisma/        # スキーマ定義
├── shared/            # 共通型定義（TypeScript）
└── docs/              # ドキュメント
```

**タスク分割（Antigravity Planning Mode向け）**
- Phase 1：データベース・API構築
- Phase 2：認証・ユーザー管理
- Phase 3：タスク管理機能
- Phase 4：ゲーミフィケーション
- Phase 5：報酬システム
- Phase 6：管理者機能

---

## 9. セキュリティ要件

### 9.1 認証・認可

**パスワードポリシー：**
- 最小8文字、英数字+記号必須
- bcryptでハッシュ化（ラウンド数12）

**JWT トークン：**
- 有効期限：24時間
- リフレッシュトークン：7日間
- HTTPOnly Cookie でセキュア保存

**RBAC（役割ベースアクセス制御）：**
- ユーザー、マネージャー、管理者の3レベル
- APIエンドポイントごとに権限チェック

### 9.2 データ保護
- 個人情報の暗号化
- HTTPS 強制（TLS 1.3）
- SQL インジェクション対策（ORM使用）
- XSS対策（Reactのエスケープ + DOMPurify）

### 9.3 レート制限

**API レート制限：**
- 一般ユーザー：100リクエスト/分
- マネージャー：200リクエスト/分
- 管理者：500リクエスト/分

**ログイン試行制限：**
- 5回失敗で15分間ロック

### 9.4 監査ログ

**重要操作の記録：**
- ポイント付与・消費
- 報酬交換
- ユーザー権限変更
- タスク削除

ログ保存期間：12ヶ月

### 9.5 コンプライアンス
- GDPR / 個人情報保護法対応
- ユーザーデータのエクスポート機能
- アカウント削除機能（完全消去）
- プライバシーポリシー：明示的な同意取得

---

## 10. 開発フェーズとスケジュール

### 10.1 開発フェーズ概要

| フェーズ | 期間 | 主要成果物 |
|----------|------|------------|
| Phase 0：環境構築 | 1週間 | 開発環境、リポジトリ、CI/CD |
| Phase 1：基盤構築 | 2週間 | DB設計、API基礎、認証 |
| Phase 2：コア機能 | 3週間 | タスク管理、ユーザー画面 |
| Phase 3：ゲーミフィケーション | 3週間 | XP/レベル、バッジ、ログインボーナス |
| Phase 4：報酬システム | 2週間 | 報酬カタログ、交換機能 |
| Phase 5：管理機能 | 2週間 | 管理ダッシュボード、レポート |
| Phase 6：テスト・改善 | 2週間 | バグ修正、UX改善、負荷テスト |
| Phase 7：デプロイ・運用開始 | 1週間 | 本番環境、ユーザートレーニング |

**合計：約16週間（4ヶ月）**

### 10.2 詳細スケジュール

#### Phase 0：環境構築（1週間）

**目標：開発の準備を整える**

- [ ] Google Antigravity のセットアップ
- [ ] GitHubリポジトリ作成
- [ ] Next.js + TypeScript プロジェクト初期化
- [ ] Node.js/Express バックエンド初期化
- [ ] PostgreSQL データベース準備
- [ ] CI/CD パイプライン設定
- [ ] 環境変数管理

#### Phase 1：基盤構築（2週間）

**Week 1：データベース**
- [ ] Prisma スキーマ定義
- [ ] マイグレーション実行
- [ ] シードデータ作成

**Week 2：認証API**
- [ ] ユーザー登録API
- [ ] ログインAPI（JWT発行）
- [ ] パスワードハッシュ化
- [ ] ミドルウェア
- [ ] フロントエンド：ログイン画面

#### Phase 2：コア機能（3週間）

**Week 3-4：タスク管理API**
- [ ] タスク一覧取得API
- [ ] タスク詳細取得API
- [ ] タスク作成API
- [ ] タスク更新・削除API
- [ ] タスク完了API
- [ ] タスク承認API

**Week 5：フロントエンド**
- [ ] ダッシュボード画面
- [ ] タスク一覧画面
- [ ] タスク詳細モーダル
- [ ] タスク作成フォーム
- [ ] タスク完了ボタン・アニメーション

#### Phase 3：ゲーミフィケーション（3週間）

**Week 6：XP・レベルシステム**
- [ ] レベルアップロジック
- [ ] タスク完了時のXP付与
- [ ] レベルアップアニメーション
- [ ] プロフィール画面

**Week 7：バッジシステム**
- [ ] バッジマスターデータ作成
- [ ] バッジ獲得判定ロジック
- [ ] バッジ獲得通知
- [ ] バッジ一覧画面

**Week 8：ログインボーナス**
- [ ] ログインストリーク記録
- [ ] ログインボーナス受取API
- [ ] ログインカレンダーUI
- [ ] デイリーログインポップアップ

#### Phase 4：報酬システム（2週間）

**Week 9：ポイント管理**
- [ ] ポイント履歴API
- [ ] ポイント残高表示
- [ ] ポイント履歴画面

**Week 10：報酬システム**
- [ ] 報酬カタログAPI
- [ ] 報酬交換API
- [ ] 報酬カタログ画面
- [ ] 交換確認モーダル
- [ ] 交換完了通知

#### Phase 5：管理機能（2週間）

**Week 11：管理ダッシュボード**
- [ ] 統計データAPI
- [ ] グラフ表示
- [ ] 管理者ダッシュボードUI

**Week 12：ユーザー・報酬管理**
- [ ] ユーザー一覧・編集画面
- [ ] 報酬カタログ編集画面
- [ ] レポート出力機能
- [ ] ポイント付与機能

#### Phase 6：テスト・改善（2週間）

- [ ] 単体テスト
- [ ] 統合テスト
- [ ] バグ修正
- [ ] UX改善
- [ ] 負荷テスト
- [ ] セキュリティチェック

#### Phase 7：デプロイ・運用開始（1週間）

- [ ] 本番環境構築
- [ ] 環境変数設定
- [ ] データベースマイグレーション
- [ ] 初期ユーザーインポート
- [ ] ユーザー向けトレーニング・マニュアル作成
- [ ] リリース🎉

---

## 11. 追加推奨事項

### 11.1 段階的リリース（MVP戦略）

**MVP（Minimum Viable Product）の範囲：**
- 認証・ログイン
- タスク管理（CRUD）
- 基本的なポイントシステム
- シンプルな報酬交換

**その後の機能追加：**
- ゲーミフィケーション強化
- 高度な報酬カタログ
- 管理者ダッシュボード

### 11.2 ユーザーフィードバック収集
- ベータテスト：社内10～20名で先行利用
- アンケート：月1回のNPS調査
- 改善サイクル：2週間ごとのスプリントで機能追加

### 11.3 KPI設定

| 指標 | 目標値（3ヶ月後） |
|------|-------------------|
| 日次アクティブユーザー（DAU） | 80%以上 |
| 平均ログインストリーク | 5日以上 |
| タスク完了率 | 85%以上 |
| ポイント交換率 | 60%以上 |
| ユーザー満足度（NPS） | 50以上 |

---

## 12. まとめ

本仕様書は、Google Antigravityを使用した企業向けゲーミフィケーションタスク管理システム「TaskQuest」の完全な設計書です。

### 主要機能のおさらい

✅ **ユーザー管理**：社員ID認証、プロフィール、権限管理  
✅ **タスク管理**：割り当て、ToDoリスト、完了承認  
✅ **ゲーミフィケーション**：XP/レベル、バッジ、ログインボーナス  
✅ **ポイント・報酬**：ポイント経済、多様な報酬カタログ  
✅ **管理機能**：ダッシュボード、レポート、設定  
✅ **給与連携**：月次集計、インセンティブ計算  

### 技術スタック

- **フロントエンド**：Next.js + TypeScript + Tailwind CSS
- **バックエンド**：Node.js/Express + Prisma
- **データベース**：PostgreSQL
- **インフラ**：Vercel + Railway/Supabase

### 開発期間

**約16週間（4ヶ月）** で本番リリース可能
